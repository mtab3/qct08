#ifndef STARS_H
#define STARS_H

#include <QTcpSocket>
#include <QStringList>
#include <QString>

#include "SMsg.h"

//#define ERROR   "Error!!"        // string を返す関数のエラー通知用

// デバイス名の定義
//#define MYNAME      "BLC"       // 自分が名乗る名前 config で変えられる様にするべき


#define STARSSERVER "localhost" // config で変えられるようにするべき
#define STARSPORT   ( 6057 )         // config で変えられるようにするべき

class Stars : public QObject 
{
  Q_OBJECT

  QString MyNameOnStars;

  QString StarsServer;
  qint16  StarsSPort;

  QStringList keys;
  int MaxKeys;
  QTcpSocket *ss;
  bool newSetting;

  void ReadHistory( void );

  int ConnectionStage;

public:
  Stars( void );
  void ReadStarsKeys( QString SelectedName, QString DefaultName );
  QString GetKey( int nkey );

  void MakeConnection( void );
  bool SendCMD( QString dev, QString cmd1, QString cmd2 = "" );
  bool SendCMD2( QString fromCh, QString dev, QString cmd1, QString cmd2 = "" );
  void SendAns( QString from, QString to, QString msg );
  void SendEvent( QString from, QString msg );

private:
  void ReadStarsCfg( void );
  QString nextItem( QString start, QString &item );

public slots:
  void SetNewSVAddress( const QString &item );
  void SetNewSVPort( const QString &item );
  void ReceiveMessageFromStars( void );
  void ReConnect( void );

signals:
  void ConnectionIsReady( Stars *s );
  void AskShowStat( QString msg, int time );
  void AskRecord( QString msg );
  void RecordSSVHistoryA( const QString &item );
  void RecordSSVHistoryP( const QString &item );
  void ReConnected( void );

  void AskIsBusy( SMsg msg );
  void AskGetValue( SMsg msg );
  void AskSetValue( SMsg msg );
  void AskSetValueREL( SMsg msg );
  void AskGetSpeedSelected( SMsg msg );
  void AskSpeedHigh( SMsg msg );
  void AskSpeedMiddle( SMsg msg );
  void AskSpeedLow( SMsg msg );
  void AskStop( SMsg msg );
  void AskRemote( SMsg msg );
  void AskStopEmergency( SMsg msg );
  void AskStandby( SMsg msg );
  void AskSyncRun( SMsg msg );
  void AskSetSpeed( SMsg msg );
};

#endif
